<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrador de Productos</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px; 
      background: #f5f5f5; 
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    #formulario {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    input, textarea, button {
      margin: 8px 0;
      padding: 10px;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    #productos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .producto {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .producto img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      margin-bottom: 15px;
      border-radius: 4px;
    }
    .producto-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .producto-actions button {
      flex: 1;
    }
    .guardar-btn {
      background-color: #2196F3;
    }
    .guardar-btn:hover {
      background-color: #0b7dda;
    }
    .eliminar-btn {
      background-color: #f44336;
    }
    .eliminar-btn:hover {
      background-color: #d32f2f;
    }
    @media (max-width: 768px) {
      #productos {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>Administrador de Productos</h1>

  <form id="formulario">
    <h2>Agregar Nuevo Producto</h2>
    <input type="text" name="nombre" placeholder="Nombre del producto" required>
    <textarea name="descripcion" placeholder="Descripción del producto" required></textarea>
    <input type="number" name="precio" placeholder="Precio (ej: 19.99)" step="0.01" min="0" required>
    <input type="file" name="imagen" accept="image/*" required>
    <button type="submit">Agregar Producto</button>
  </form>

  <div id="productos"></div>

  <script>
    const API_URL = "https://productos-backend-d1di.onrender.com"; // Cambiar por tu URL real
    
    // Cargar productos al iniciar
    document.addEventListener('DOMContentLoaded', cargarProductos);

    async function cargarProductos() {
      try {
        const res = await fetch(`${API_URL}/productos`);
        if (!res.ok) throw new Error('Error al cargar productos');
        
        const productos = await res.json();
        const contenedor = document.getElementById("productos");
        contenedor.innerHTML = "";
        
        productos.forEach(p => {
          contenedor.innerHTML += `
            <div class="producto" data-id="${p.id}">
              <img src="${API_URL}${p.imagen}" alt="${p.nombre}" onerror="this.src='https://via.placeholder.com/300?text=Imagen+no+disponible'">
              <input type="text" value="${p.nombre}" id="nombre-${p.id}" placeholder="Nombre">
              <textarea id="desc-${p.id}" placeholder="Descripción">${p.descripcion}</textarea>
              <input type="number" value="${p.precio}" id="precio-${p.id}" step="0.01" min="0" placeholder="Precio">
              <input type="file" id="img-${p.id}" accept="image/*">
              <div class="producto-actions">
                <button onclick="guardarCambios('${p.id}')" class="guardar-btn">Guardar Cambios</button>
                <button onclick="eliminarProducto('${p.id}')" class="eliminar-btn">Eliminar</button>
              </div>
            </div>
          `;
        });
      } catch (error) {
        console.error("Error:", error);
        alert("Error al cargar productos: " + error.message);
      }
    }

    async function eliminarProducto(id) {
      if (!confirm("¿Estás seguro de eliminar este producto?")) return;
      
      try {
        const res = await fetch(`${API_URL}/productos/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error('Error al eliminar');
        cargarProductos();
      } catch (error) {
        console.error("Error:", error);
        alert("Error al eliminar producto: " + error.message);
      }
    }

    document.getElementById("formulario").addEventListener("submit", async e => {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      
      try {
        const res = await fetch(`${API_URL}/productos`, { 
          method: "POST", 
          body: data 
        });
        
        if (!res.ok) throw new Error('Error al agregar producto');
        
        form.reset();
        cargarProductos();
        alert("Producto agregado con éxito!");
      } catch (error) {
        console.error("Error:", error);
        alert("Error al agregar producto: " + error.message);
      }
    });
    
    async function guardarCambios(id) {
      const nombre = document.getElementById(`nombre-${id}`).value;
      const descripcion = document.getElementById(`desc-${id}`).value;
      const precio = parseFloat(document.getElementById(`precio-${id}`).value);
      const nuevaImagen = document.getElementById(`img-${id}`).files[0];

      try {
        if (nuevaImagen) {
          // Si hay nueva imagen, actualizamos todo el producto
          const formData = new FormData();
          formData.append("nombre", nombre);
          formData.append("descripcion", descripcion);
          formData.append("precio", precio);
          formData.append("imagen", nuevaImagen);

          await fetch(`${API_URL}/productos/${id}`, { 
            method: "PUT",
            body: formData
          });
        } else {
          // Si no hay nueva imagen, solo actualizamos los datos
          await fetch(`${API_URL}/productos/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              id,
              nombre,
              descripcion,
              precio,
              imagen: `/static/${id}.jpg`
            })
          });
        }
        
        cargarProductos();
        alert("Producto actualizado con éxito!");
      } catch (error) {
        console.error("Error:", error);
        alert("Error al actualizar producto: " + error.message);
      }
    }
  </script>
</body>
</html>
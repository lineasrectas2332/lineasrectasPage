<!DOCTYPE html> 
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Producto</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
                
        /* Header */

        .subheader {
        font-size: 0.45em; /* Tama침o m치s peque침o */
        font-weight: normal; /* Peso normal para diferenciar del encabezado */
        color: white; /* Mismo color blanco que el texto principal */
        display: block; /* Para asegurarte de que se muestre en una nueva l칤nea */
        margin-top: -5px; /* Ajuste para reducir el espacio entre los textos */
        }

        #producto-detalle {
            text-align: center;
        }

        #producto-detalle img {
            display: block;
            margin: 0 auto;
        }

        .carousel-inner img {
            max-height: 500px;
            object-fit: contain;
            cursor: pointer; /* Aparece el cursor de puntero al pasar sobre las im치genes */
        }

        /* Estilo para el modal */
        .modal-content img {
            width: 100%;
            max-height: 80vh; /* La imagen no se expandir치 m치s all치 del 80% de la altura de la ventana */
            object-fit: contain;
        }

        /* Estilo para los botones de control del carrusel */
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: black; /* Cambiar los 칤conos de los botones a negro */
        }

        /* Estilo para el contenedor de los botones de control */
        .carousel-control-prev,
        .carousel-control-next {
            filter: invert(100%); /* Asegura que el 칤cono negro sea visible en el fondo blanco */
        }

        /* Cuando el mouse pasa sobre los botones de control, cambiar el color */
        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            background-color: black; /* Aseguramos que el fondo sea negro al pasar el mouse */
        }

        /* Estilo para el bot칩n de WhatsApp */
        .whatsapp-btn {
            background-color: #25d366;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.2rem;
            margin-top: 20px;
        }

        .whatsapp-btn:hover {
            background-color: #128c7e;
        }
        .whatsapp-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: black;
            color: white;
            text-decoration: none;
            font-family: "Montserrat", sans-serif;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
            text-align: center;
            margin-bottom: 60px; /* 游녣 ESPACIO AGREGADO */
        }

        .whatsapp-btn:hover {
            background-color: #444;
            transform: scale(1.05);
        }

        /* Estilos adicionales para asegurar que las im치genes se muestren */
        .carousel-item img {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: contain;
        }

        /* Indicadores del carrusel */
        .carousel-indicators button {
            background-color: #000;
        }
/* Pie de p치gina */
footer {
    text-align: center;
    padding: 10px;
    background-color: black;
    color: white;
    width: 100%;
}

.footer-info {
    margin-bottom: 20px;
}
.footer-info h3, .footer-info p {
    margin: 10px 0;
}

.footer-redes {
    display: flex;
    justify-content: center;
}

.footer-redes ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.wpp-footer, .ig-footer {
    text-decoration: none;
    color: white;
}

.footer-redes li {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 10px;
}

.footer-copy {
    margin-top: 20px;
}

#fotou {
    width: 30px;
    height: auto;
}

.logoabajo {
    width: 100px;
    height: auto;
    margin: 0 auto;
}

    </style>
</head>
<body>
    <header class="header">
        <nav class="navbar navbar-expand-lg" style="background-color: black;">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="images/IMG_5160.JPG" alt="Logo" width="30" height="30">
                </a>
                <a class="navbar-brand" href="index.html" style="color: white; text-align: center;">
                    LINEAS RECTAS<br>
                    <span class="subheader">AMOBLAMIENTOS</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon" style="color: white;"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html" style="color: white;">HOME</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: white;">PRODUCTOS</a>
                            <ul class="dropdown-menu" style="background-color: black;">
                                <li><a id="vertodos" class="dropdown-item" href="indexProd.html" style="color: white;">Ver Todos</a></li>
                                <li><a class="dropdown-item" href="#" style="color: white;">Living</a></li>
                                <li><a class="dropdown-item" href="#" style="color: white;">Dormitorio</a></li>
                                <li><a class="dropdown-item" href="#" style="color: white;">Comedor</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="#" style="color: white;">CATALOGO DE COLORES</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" style="color: white;">CONTACTO</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <section id="detalle-producto" class="container mt-5">
        <div id="producto-detalle">
            <!-- Los detalles del producto se cargar치n din치micamente aqu칤 -->
        </div>
    </section>

    <footer>
  <div class="footer-info">
    <img class="logoabajo" src="images/IMG_5013.JPG" alt="">
    <h3>LINEAS RECTAS</h3>
    <p>Villa Maria, CBA.</p>
    <p>Porfirio Seppey 315</p>
    <p>+54-9353 6574696</p>
    <p>lineasrectas@gmail.com</p>
  </div>
  <div class="footer-redes">
    <ul>
      <li>
        <img id="fotou" src="images/instagram-new.png" alt="Instagram">
        <a class="ig-footer" href="https://www.instagram.com/lineasrectas_amoblamientos/" target="_blank">Instagram</a>
      </li>
      <li>
        <img id="fotou" src="images/whatsapp.png" alt="WhatsApp">
        <a class="wpp-footer" href="https://wa.me/5493536574696" target="_blank">WhatsApp</a>
      </li>
    </ul>
  </div>
</footer>
    <!-- Modal para ver imagen en detalle -->
    <div class="modal fade" id="modalImagen" tabindex="-1" aria-labelledby="modalImagenLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="" alt="Imagen ampliada" id="imagenAmpliada">
                </div>
            </div>
        </div>
    </div>
    
   <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://tldqbupxdkvolymtndrn.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsZHFidXB4ZGt2b2x5bXRuZHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NDE0NzYsImV4cCI6MjA3NTAxNzQ3Nn0.Y1YaA-qHYVAEn4rSA0LC6nGmG0RQ70zoxodLuMXOmW0';
  const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const params = new URLSearchParams(window.location.search);
  const id = parseInt(params.get('id'), 10);

  // Escape text to avoid HTML injection when inserting nombre/descripcion en innerHTML
  function escapeHtml(str) {
    if (str == null) return '';
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // Normaliza/extrae un array de URLs desde p.imagenes_urls (array real, JSON-string, comma-separated, single URL)
  function normalizeImages(p) {
    if (!p) return [];

    // 1) si ya es array
    if (Array.isArray(p.imagenes_urls)) {
      return p.imagenes_urls.filter(Boolean);
    }

    const field = p.imagenes_urls;

    // 2) si es string -> intentar parse JSON, luego fallback a coma-separado o single-url
    if (typeof field === 'string' && field.trim().length > 0) {
      // intentar JSON.parse
      try {
        const parsed = JSON.parse(field);
        if (Array.isArray(parsed)) return parsed.filter(Boolean);
        if (typeof parsed === 'string' && parsed.trim()) return [parsed.trim()];
        if (parsed && typeof parsed === 'object') {
          // por si fuese un objeto con campos URL
          return Object.values(parsed).filter(v => typeof v === 'string' && v.trim());
        }
      } catch (e) {
        // no es JSON: puede ser lista separada por comas
        if (field.includes(',')) {
          return field.split(',').map(s => s.trim()).filter(Boolean);
        }
        return [field.trim()];
      }
    }

    // 3) fallback a imagen_url (campo individual)
    if (p.imagen_url && typeof p.imagen_url === 'string' && p.imagen_url.trim()) {
      return [p.imagen_url.trim()];
    }

    return [];
  }

  async function cargarProducto() {
    const cont = document.getElementById('producto-detalle');
    if (!cont) return console.error('No existe el contenedor #producto-detalle en el HTML');

    if (!id || isNaN(id)) {
      cont.innerHTML = '<p>Id de producto inv치lido en la URL.</p>';
      return;
    }

    cont.innerHTML = `<p>Cargando...</p>`;

    const { data: p, error } = await client.from('productos').select('*').eq('id', id).single();
    if (error || !p) {
      cont.innerHTML = `<p>Error al cargar producto${error ? ': ' + escapeHtml(error.message) : ''}</p>`;
      console.error('Error cargando producto:', error);
      return;
    }

    console.log("Producto cargado:", p); // depuraci칩n

    // Obtener array de im치genes de forma defensiva
    let imagenes = normalizeImages(p);
    if (!imagenes || imagenes.length === 0) {
      imagenes = [p.imagen_url || 'https://via.placeholder.com/500?text=Sin+imagen'];
    }

    const carouselId = `carruselProducto-${id}`;

    // Generar slides e indicadores
    let slides = '';
    let indicators = '';
    imagenes.forEach((url, i) => {
      const safeUrl = url || 'https://via.placeholder.com/500?text=Error+al+cargar+imagen';
      slides += `
        <div class="carousel-item ${i === 0 ? 'active' : ''}">
          <img src="${safeUrl}" class="d-block w-100" alt="Imagen ${i+1}" onerror="this.src='https://via.placeholder.com/500?text=Error+al+cargar+imagen'">
        </div>`;
      if (imagenes.length > 1) {
        indicators += `
          <button type="button" data-bs-target="#${carouselId}" data-bs-slide-to="${i}" class="${i === 0 ? 'active' : ''}" aria-label="Slide ${i+1}" ${i === 0 ? 'aria-current="true"' : ''}></button>`;
      }
    });

    // Construir HTML final (uso escapeHtml en nombre/descr)
    const nombreSafe = escapeHtml(p.nombre);
    const descSafe = escapeHtml(p.descripcion);
    const precioSafe = (typeof p.precio === 'number' && isFinite(p.precio)) ? p.precio.toLocaleString('es-AR') : escapeHtml(p.precio);

    cont.innerHTML = `
      <div id="${carouselId}" class="carousel slide mb-3" data-bs-ride="${imagenes.length > 1 ? 'carousel' : 'false'}">
        ${imagenes.length > 1 ? `<div class="carousel-indicators">${indicators}</div>` : ''}
        <div class="carousel-inner">${slides}</div>
        ${imagenes.length > 1 ? `
          <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
          </button>
        ` : ''}
      </div>

      <h2>${nombreSafe}</h2>
      <p>${descSafe}</p>
      <p><strong>Precio:</strong> $${precioSafe}</p>
      <a href="https://wa.me/5493536574696?text=Estoy%20interesado%20en%20${encodeURIComponent(p.nombre || '')}" class="whatsapp-btn" target="_blank">Comprar Producto</a>
    `;

    // Agregar funcionalidad para abrir imagen en modal al hacer clic
    // (selector limitado al carousel actual para evitar conflictos)
    const imgs = document.querySelectorAll(`#${carouselId} .carousel-item img`);
    imgs.forEach(img => {
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', function () {
        const modalImg = document.getElementById('imagenAmpliada');
        if (!modalImg) return console.warn('No se encontr칩 #imagenAmpliada para el modal');
        modalImg.src = this.src;
        const modalEl = document.getElementById('modalImagen');
        if (!modalEl) return console.warn('No se encontr칩 #modalImagen para el modal');
        const modal = new bootstrap.Modal(modalEl);
        modal.show();
      });
    });
  }

  document.addEventListener('DOMContentLoaded', cargarProducto);
</script>


</body>
</html>